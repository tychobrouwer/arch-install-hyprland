- name: Check if logged in
  ansible.builtin.shell: "spotify_player like"
  register: spotify_player_status
  changed_when: false
  failed_when: false

- block:
    - name: Ask user for Spotify username
      ansible.builtin.pause:
        prompt: "Enter your Spotify username"
        echo: true
      register: spotify_player_username

    - name: Ask user for Spotify password
      ansible.builtin.pause:
        prompt: "Enter your Spotify password"
        echo: false
      register: spotify_player_password

    - name: login for spotify_player
      ansible.builtin.expect:
        command: "spotify_player authenticate"
        responses:
          "Username": "{{ spotify_player_username }}"
          "Password": "{{ spotify_player_password }}"
  when: "'No cached credentials found' in spotify_player_status.stdout"
  become: true
  become_user: "{{ user }}"
